<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Administraci√≥n de Resultados</title>
    <link rel="stylesheet" href="../css/styles.css">
    <style>
        .admin-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .login-screen {
            max-width: 400px;
            margin: 100px auto;
            padding: 40px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .login-screen h2 {
            text-align: center;
            color: #c41e3a;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            box-sizing: border-box;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #c41e3a;
        }

        .btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #c41e3a 0%, #8b1429 100%);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(196, 30, 58, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            margin-top: 10px;
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%);
        }

        .admin-header {
            background: linear-gradient(135deg, #c41e3a 0%, #8b1429 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .admin-header h1 {
            margin: 0;
            font-size: 1.8em;
        }

        .filter-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .filter-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .jornada-admin {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .jornada-admin-header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-weight: bold;
            font-size: 1.2em;
        }

        .game-admin-card {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .game-admin-card.has-score {
            border-color: #28a745;
            background: #f1f9f3;
        }

        .game-teams-admin {
            display: grid;
            grid-template-columns: 2fr auto 2fr;
            gap: 15px;
            align-items: center;
            margin-bottom: 15px;
        }

        .team-score-input {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .team-score-input label {
            font-weight: bold;
            color: #333;
        }

        .team-score-input input {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 18px;
            font-weight: bold;
            text-align: center;
        }

        .vs-separator {
            font-size: 1.5em;
            font-weight: bold;
            color: #c41e3a;
            text-align: center;
        }

        .game-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .stats-panel {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .stat-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #c41e3a;
        }

        .stat-label {
            color: #666;
            margin-top: 5px;
            font-size: 0.9em;
        }

        .alert {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .alert-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .alert-info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }

        @media (max-width: 768px) {
            .admin-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .game-teams-admin {
                grid-template-columns: 1fr;
            }

            .vs-separator {
                margin: 10px 0;
            }

            .game-actions {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Pantalla de Login -->
    <div id="login-screen" class="login-screen">
        <h2>üîí Acceso Administrativo</h2>
        <p style="text-align: center; color: #666; margin-bottom: 20px;">
            Ingresa la contrase√±a para actualizar resultados
        </p>
        <div class="form-group">
            <label>Contrase√±a:</label>
            <input type="password" id="admin-password" placeholder="Ingresa la contrase√±a">
        </div>
        <button class="btn" onclick="login()">Ingresar</button>
        <p style="text-align: center; margin-top: 20px; font-size: 0.9em; color: #28a745;">
            üîê Acceso protegido con encriptaci√≥n
        </p>
    </div>

    <!-- Panel Administrativo -->
    <div id="admin-panel" class="admin-container" style="display: none;">
        <div class="admin-header">
            <h1>‚öæ Panel de Administraci√≥n</h1>
            <button class="btn btn-secondary" onclick="logout()" style="width: auto; padding: 10px 20px;">
                Cerrar Sesi√≥n
            </button>
        </div>

        <!-- Tabs de navegaci√≥n -->
        <div style="background: white; border-radius: 10px; padding: 10px; margin-bottom: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
            <button class="btn" id="tab-results" onclick="switchTab('results')" style="flex: 1; min-width: 200px;">
                üìä Resultados de Juegos
            </button>
            <button class="btn btn-secondary" id="tab-news" onclick="switchTab('news')" style="flex: 1; min-width: 200px;">
                üì∞ Noticias
            </button>
            <button class="btn btn-secondary" id="tab-backup" onclick="switchTab('backup')" style="flex: 1; min-width: 200px;">
                üíæ Backup de Datos
            </button>
        </div>

        <!-- Secci√≥n de Resultados -->
        <div id="section-results">

        <div class="stats-panel">
            <h3>üìä Estad√≠sticas Generales</h3>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="total-games">0</div>
                    <div class="stat-label">Total de Juegos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="completed-games">0</div>
                    <div class="stat-label">Juegos Completados</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="pending-games">0</div>
                    <div class="stat-label">Juegos Pendientes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="games-with-score">0</div>
                    <div class="stat-label">Con Marcador</div>
                </div>
            </div>
        </div>

        <div class="filter-section">
            <h3>üîç Filtros</h3>
            <div class="filter-group">
                <div class="form-group">
                    <label>Vuelta:</label>
                    <select id="filter-vuelta" onchange="applyFilters()">
                        <option value="all">Todas</option>
                        <option value="primera">Primera Vuelta</option>
                        <option value="segunda">Segunda Vuelta</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Estado:</label>
                    <select id="filter-status" onchange="applyFilters()">
                        <option value="all">Todos</option>
                        <option value="completed">Completados</option>
                        <option value="pending">Pendientes</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Jornada:</label>
                    <select id="filter-jornada" onchange="applyFilters()">
                        <option value="all">Todas</option>
                    </select>
                </div>
            </div>
        </div>

        <div id="games-admin-container">
            <!-- Los juegos se cargar√°n aqu√≠ -->
        </div>
        </div>
        <!-- Fin Secci√≥n de Resultados -->

        <!-- Secci√≥n de Noticias -->
        <div id="section-news" style="display: none;">
            <div class="stats-panel">
                <h3>üì∞ Gesti√≥n de Noticias</h3>
                <p style="color: #666; margin-bottom: 20px;">Crea, edita y elimina noticias que aparecer√°n en la p√°gina principal</p>
                
                <button class="btn btn-success" onclick="showNewsForm()" style="width: 100%; margin-bottom: 20px;">
                    ‚ûï Crear Nueva Noticia
                </button>

                <div id="news-form" style="display: none; background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h4 style="margin-top: 0;">Nueva Noticia</h4>
                    <div class="form-group">
                        <label>Emoji o Icono:</label>
                        <select id="news-emoji" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;">
                            <option value="üì∞">üì∞ Noticia General</option>
                            <option value="‚öæ">‚öæ Beisbol</option>
                            <option value="üèÜ">üèÜ Torneo/Campeonato</option>
                            <option value="üë•">üë• Equipo</option>
                            <option value="üìÖ">üìÖ Evento</option>
                            <option value="üéâ">üéâ Celebraci√≥n</option>
                            <option value="‚≠ê">‚≠ê Destacado</option>
                            <option value="üì∏">üì∏ Galer√≠a/Fotos</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Fecha:</label>
                        <input type="date" id="news-date" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;">
                    </div>
                    <div class="form-group">
                        <label>T√≠tulo de la Noticia:</label>
                        <input type="text" id="news-title" placeholder="Ej: Inicio de Temporada 2025-2026" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;">
                    </div>
                    <div class="form-group">
                        <label>Contenido/Descripci√≥n:</label>
                        <textarea id="news-content" rows="4" placeholder="Describe la noticia..." style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px; resize: vertical;"></textarea>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-success" onclick="saveNewsItem()" style="flex: 1;">
                            üíæ Guardar Noticia
                        </button>
                        <button class="btn btn-secondary" onclick="cancelNewsForm()" style="flex: 1;">
                            ‚ùå Cancelar
                        </button>
                    </div>
                </div>

                <div id="news-list">
                    <!-- Las noticias se cargar√°n aqu√≠ -->
                </div>
            </div>
        </div>
        <!-- Fin Secci√≥n de Noticias -->

        <!-- Secci√≥n de Backup -->
        <div id="section-backup" style="display: none;">
            <div class="stats-panel">
                <h3>üíæ Gesti√≥n de Backup de Datos</h3>
                <p style="color: #666; margin-bottom: 30px;">
                    Exporta e importa los datos en formato JSON para compartir con otros dispositivos o hacer respaldos
                </p>

                <!-- Sincronizar desde Servidor -->
                <div style="background: #e1f5fe; border: 2px solid #0288d1; border-radius: 10px; padding: 20px; margin-bottom: 30px;">
                    <h4 style="color: #01579b; margin-top: 0;">üîÑ Sincronizar desde Servidor</h4>
                    <p style="color: #666; margin-bottom: 15px;">Carga los datos publicados en el servidor hacia tu localStorage</p>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                        <button class="btn" onclick="syncResultsFromServer()" style="width: 100%; background: #0288d1;">
                            üîÑ Sincronizar Resultados
                        </button>
                        <button class="btn" onclick="syncNewsFromServer()" style="width: 100%; background: #0288d1;">
                            üîÑ Sincronizar Noticias
                        </button>
                        <button class="btn" onclick="syncAllFromServer()" style="width: 100%; background: #0288d1;">
                            üîÑ Sincronizar Todo
                        </button>
                    </div>
                    <p style="color: #01579b; font-size: 0.9em; margin-top: 15px; background: white; padding: 10px; border-radius: 5px;">
                        üí° √ötil para cargar cambios de otros administradores o ver los datos publicados en el sitio
                    </p>
                </div>

                <!-- Exportar Datos -->
                <div style="background: #e8f5e9; border: 2px solid #4caf50; border-radius: 10px; padding: 20px; margin-bottom: 30px;">
                    <h4 style="color: #2e7d32; margin-top: 0;">üì§ Exportar Datos</h4>
                    <p style="color: #666; margin-bottom: 15px;">Descarga los datos en archivos JSON para hacer backup o compartir</p>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                        <button class="btn btn-success" onclick="exportResults()" style="width: 100%;">
                            üìä Exportar Resultados
                        </button>
                        <button class="btn btn-success" onclick="exportNewsData()" style="width: 100%;">
                            üì∞ Exportar Noticias
                        </button>
                        <button class="btn btn-success" onclick="exportAllData()" style="width: 100%;">
                            üì¶ Exportar Todo
                        </button>
                    </div>
                </div>

                <!-- Importar Datos -->
                <div style="background: #fff3e0; border: 2px solid #ff9800; border-radius: 10px; padding: 20px; margin-bottom: 30px;">
                    <h4 style="color: #e65100; margin-top: 0;">üì• Importar Datos</h4>
                    <p style="color: #666; margin-bottom: 15px;">Carga datos desde archivos JSON previamente exportados</p>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #333;">Importar Resultados:</label>
                            <input type="file" id="import-results" accept=".json" style="display: none;" onchange="importResultsFile(event)">
                            <button class="btn" onclick="document.getElementById('import-results').click()" style="width: 100%; background: #ff9800;">
                                üìä Seleccionar Archivo
                            </button>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #333;">Importar Noticias:</label>
                            <input type="file" id="import-news" accept=".json" style="display: none;" onchange="importNewsFile(event)">
                            <button class="btn" onclick="document.getElementById('import-news').click()" style="width: 100%; background: #ff9800;">
                                üì∞ Seleccionar Archivo
                            </button>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #333;">Importar Todo:</label>
                            <input type="file" id="import-all" accept=".json" style="display: none;" onchange="importAllFile(event)">
                            <button class="btn" onclick="document.getElementById('import-all').click()" style="width: 100%; background: #ff9800;">
                                üì¶ Seleccionar Archivo
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Informaci√≥n -->
                <div style="background: #e3f2fd; border: 2px solid #2196f3; border-radius: 10px; padding: 20px;">
                    <h4 style="color: #0d47a1; margin-top: 0;">‚ÑπÔ∏è Informaci√≥n Importante</h4>
                    <ul style="color: #666; line-height: 1.8; padding-left: 20px;">
                        <li><strong>Formato JSON:</strong> Los archivos se guardan en formato JSON est√°ndar</li>
                        <li><strong>Compartir datos:</strong> Env√≠a los archivos JSON a otros administradores</li>
                        <li><strong>Backup regular:</strong> Exporta los datos peri√≥dicamente como respaldo</li>
                        <li><strong>Importar sobrescribe:</strong> Al importar, se reemplazar√°n los datos actuales (solo localStorage)</li>
                        <li><strong>Compatible:</strong> Los archivos funcionan en cualquier navegador/dispositivo</li>
                    </ul>
                </div>

                <!-- Publicar en el Sitio -->
                <div style="background: #fff9c4; border: 2px solid #fbc02d; border-radius: 10px; padding: 20px; margin-top: 20px;">
                    <h4 style="color: #f57f17; margin-top: 0;">üåê Publicar Cambios en el Sitio Web</h4>
                    <p style="color: #666; margin-bottom: 15px;">
                        Para que <strong>todos los usuarios</strong> vean los cambios que hiciste:
                    </p>
                    <ol style="color: #666; line-height: 1.8; padding-left: 20px;">
                        <li><strong>Exporta los datos:</strong> Click en "üìä Exportar Resultados" y "üì∞ Exportar Noticias"</li>
                        <li><strong>Renombra los archivos:</strong>
                            <br>‚Ä¢ <code>resultados_liga_2025-XX-XX.json</code> ‚Üí <code>results.json</code>
                            <br>‚Ä¢ <code>noticias_liga_2025-XX-XX.json</code> ‚Üí <code>news.json</code>
                        </li>
                        <li><strong>Sube al servidor:</strong> Reemplaza los archivos en la carpeta <code>data/</code> del servidor</li>
                        <li><strong>Verifica:</strong> Recarga la p√°gina principal y verifica que los cambios aparezcan</li>
                    </ol>
                    <p style="color: #f57f17; font-weight: bold; margin-top: 15px; background: white; padding: 10px; border-radius: 5px;">
                        üí° Tip: Los cambios en localStorage (este panel) son solo tuyos. Para publicarlos, debes exportar y subir al servidor.
                    </p>
                </div>
            </div>
        </div>
        <!-- Fin Secci√≥n de Backup -->

    </div>

    <script src="../js/data.js"></script>
    <script src="../js/results.js"></script>
    <script src="../js/news.js"></script>
    <script>
        // Configuraci√≥n
        // Hash SHA-1 de la contrase√±a "Perico123"
        const ADMIN_PASSWORD_HASH = 'da66ffe6e26d2de7fcaf4452e5cef7075cafee9c';
        // STORAGE_KEY ya est√° definido en results.js

        // Estado
        let gameResults = {};

        // Funci√≥n para hashear la contrase√±a usando SHA-1 (compatible con todos los navegadores)
        async function hashPassword(password) {
            const encoder = new TextEncoder();
            const data = encoder.encode(password);
            const hashBuffer = await crypto.subtle.digest('SHA-1', data);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
            return hashHex;
        }

        // Cargar resultados del localStorage
        function loadResults() {
            const stored = localStorage.getItem(STORAGE_KEY);
            if (stored) {
                try {
                    gameResults = JSON.parse(stored);
                } catch (e) {
                    gameResults = {};
                }
            }
        }

        // Guardar resultados en localStorage
        function saveResults() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(gameResults));
        }

        // Login con contrase√±a hasheada
        async function login() {
            const password = document.getElementById('admin-password').value;
            const passwordHash = await hashPassword(password);
            
            // Debug: mostrar hash generado (remover en producci√≥n)
            //console.log('Hash generado:', passwordHash);
            //console.log('Hash esperado:', ADMIN_PASSWORD_HASH);
            
            if (passwordHash === ADMIN_PASSWORD_HASH) {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('admin-panel').style.display = 'block';
                initAdmin();
            } else {
                alert('‚ùå Contrase√±a incorrecta\n');
                document.getElementById('admin-password').value = '';
            }
        }

        // Logout
        function logout() {
            document.getElementById('login-screen').style.display = 'block';
            document.getElementById('admin-panel').style.display = 'none';
            document.getElementById('admin-password').value = '';
        }

        // Inicializar panel admin
        function initAdmin() {
            loadResults();
            populateJornadaFilter();
            renderGamesAdmin();
            updateStats();
            switchTab('results'); // Mostrar pesta√±a de resultados por defecto
        }

        // Cambiar entre pesta√±as
        function switchTab(tab) {
            // Ocultar todas las secciones
            document.getElementById('section-results').style.display = 'none';
            document.getElementById('section-news').style.display = 'none';
            document.getElementById('section-backup').style.display = 'none';
            
            // Resetear estilos de botones
            document.getElementById('tab-results').className = 'btn btn-secondary';
            document.getElementById('tab-news').className = 'btn btn-secondary';
            document.getElementById('tab-backup').className = 'btn btn-secondary';
            
            // Mostrar secci√≥n seleccionada
            if (tab === 'results') {
                document.getElementById('section-results').style.display = 'block';
                document.getElementById('tab-results').className = 'btn';
            } else if (tab === 'news') {
                document.getElementById('section-news').style.display = 'block';
                document.getElementById('tab-news').className = 'btn';
                loadNewsList();
            } else if (tab === 'backup') {
                document.getElementById('section-backup').style.display = 'block';
                document.getElementById('tab-backup').className = 'btn';
            }
        }

        // Mostrar formulario de nueva noticia
        function showNewsForm(newsId = null) {
            const form = document.getElementById('news-form');
            const today = new Date().toISOString().split('T')[0];
            
            if (newsId) {
                // Editar noticia existente
                const news = getNewsById(newsId);
                if (news) {
                    document.getElementById('news-emoji').value = news.emoji;
                    document.getElementById('news-date').value = news.date;
                    document.getElementById('news-title').value = news.title;
                    document.getElementById('news-content').value = news.content;
                    form.querySelector('h4').textContent = 'Editar Noticia';
                    form.dataset.editId = newsId;
                }
            } else {
                // Nueva noticia
                document.getElementById('news-emoji').value = 'üì∞';
                document.getElementById('news-date').value = today;
                document.getElementById('news-title').value = '';
                document.getElementById('news-content').value = '';
                form.querySelector('h4').textContent = 'Nueva Noticia';
                delete form.dataset.editId;
            }
            
            form.style.display = 'block';
        }

        // Cancelar formulario de noticia
        function cancelNewsForm() {
            document.getElementById('news-form').style.display = 'none';
        }

        // Guardar noticia
        function saveNewsItem() {
            const emoji = document.getElementById('news-emoji').value;
            const date = document.getElementById('news-date').value;
            const title = document.getElementById('news-title').value.trim();
            const content = document.getElementById('news-content').value.trim();
            const form = document.getElementById('news-form');
            const editId = form.dataset.editId;

            if (!title || !content || !date) {
                alert('‚ö†Ô∏è Por favor completa todos los campos');
                return;
            }

            let success = false;
            if (editId) {
                // Actualizar noticia existente
                success = updateNews(editId, { emoji, date, title, content });
                if (success) {
                    showNotification('‚úÖ Noticia actualizada correctamente', 'success');
                }
            } else {
                // Crear nueva noticia
                success = addNews({ emoji, date, title, content });
                if (success) {
                    showNotification('‚úÖ Noticia creada correctamente', 'success');
                }
            }

            if (success) {
                cancelNewsForm();
                loadNewsList();
            }
        }

        // Cargar lista de noticias
        function loadNewsList() {
            const container = document.getElementById('news-list');
            const news = getAllNews();

            if (news.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #666; background: white; border-radius: 10px;">
                        <p style="font-size: 1.2em; margin-bottom: 10px;">üì∞ No hay noticias registradas</p>
                        <p>Crea tu primera noticia usando el bot√≥n de arriba</p>
                    </div>
                `;
                return;
            }

            let html = '<div style="display: flex; flex-direction: column; gap: 15px;">';
            news.forEach(item => {
                const formattedDate = formatNewsDate(item.date);
                html += `
                    <div style="background: white; border-radius: 10px; padding: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                            <div style="flex: 1;">
                                <div style="font-size: 2em; margin-bottom: 5px;">${item.emoji}</div>
                                <p style="color: #666; font-size: 0.9em; margin: 0 0 5px 0;">${formattedDate}</p>
                                <h4 style="margin: 0 0 10px 0; color: #c41e3a;">${item.title}</h4>
                                <p style="margin: 0; color: #333; line-height: 1.6;">${item.content}</p>
                            </div>
                            <div style="display: flex; gap: 10px; margin-left: 15px;">
                                <button onclick="showNewsForm('${item.id}')" style="padding: 8px 15px; background: #17a2b8; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;">
                                    ‚úèÔ∏è Editar
                                </button>
                                <button onclick="deleteNewsItem('${item.id}')" style="padding: 8px 15px; background: #dc3545; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;">
                                    üóëÔ∏è Eliminar
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            container.innerHTML = html;
        }

        // Eliminar noticia
        function deleteNewsItem(id) {
            if (confirm('¬øEst√°s seguro de que quieres eliminar esta noticia?')) {
                if (deleteNews(id)) {
                    showNotification('‚úÖ Noticia eliminada correctamente', 'success');
                    loadNewsList();
                }
            }
        }

        // ========== FUNCIONES DE SINCRONIZACI√ìN ==========

        // Sincronizar resultados desde el servidor
        async function syncResultsFromServer() {
            if (!confirm('¬øDeseas cargar los resultados del servidor?\n\nEsto reemplazar√° tus datos locales actuales.')) {
                return;
            }

            try {
                const url = '../data/results.json';
                const response = await fetch(url);
                
                if (response.ok) {
                    const data = await response.json();
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
                    showNotification('‚úÖ Resultados sincronizados correctamente desde el servidor', 'success');
                    setTimeout(() => {
                        showNotification('üîÑ Recargando p√°gina...', 'info');
                        setTimeout(() => location.reload(), 1000);
                    }, 1500);
                } else {
                    showNotification('‚ùå No se encontr√≥ el archivo de resultados en el servidor', 'warning');
                }
            } catch (error) {
                showNotification('‚ùå Error al sincronizar resultados', 'warning');
                console.error('Error:', error);
            }
        }

        // Sincronizar noticias desde el servidor
        async function syncNewsFromServer() {
            if (!confirm('¬øDeseas cargar las noticias del servidor?\n\nEsto reemplazar√° tus noticias locales actuales.')) {
                return;
            }

            try {
                const url = '../data/news.json';
                const response = await fetch(url);
                
                if (response.ok) {
                    const data = await response.json();
                    localStorage.setItem(NEWS_STORAGE_KEY, JSON.stringify(data));
                    showNotification('‚úÖ Noticias sincronizadas correctamente desde el servidor', 'success');
                    setTimeout(() => {
                        showNotification('üîÑ Recargando p√°gina...', 'info');
                        setTimeout(() => location.reload(), 1000);
                    }, 1500);
                } else {
                    showNotification('‚ùå No se encontr√≥ el archivo de noticias en el servidor', 'warning');
                }
            } catch (error) {
                showNotification('‚ùå Error al sincronizar noticias', 'warning');
                console.error('Error:', error);
            }
        }

        // Sincronizar todo desde el servidor
        async function syncAllFromServer() {
            if (!confirm('¬øDeseas cargar TODOS los datos del servidor?\n\nEsto reemplazar√° todos tus datos locales actuales.')) {
                return;
            }

            try {
                const resultsUrl = '../data/results.json';
                const newsUrl = '../data/news.json';
                
                const [resultsResponse, newsResponse] = await Promise.all([
                    fetch(resultsUrl),
                    fetch(newsUrl)
                ]);

                let syncCount = 0;
                
                if (resultsResponse.ok) {
                    const resultsData = await resultsResponse.json();
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(resultsData));
                    syncCount++;
                }
                
                if (newsResponse.ok) {
                    const newsData = await newsResponse.json();
                    localStorage.setItem(NEWS_STORAGE_KEY, JSON.stringify(newsData));
                    syncCount++;
                }

                if (syncCount > 0) {
                    showNotification(`‚úÖ ${syncCount} archivo(s) sincronizado(s) correctamente`, 'success');
                    setTimeout(() => {
                        showNotification('üîÑ Recargando p√°gina...', 'info');
                        setTimeout(() => location.reload(), 1000);
                    }, 1500);
                } else {
                    showNotification('‚ùå No se encontraron archivos en el servidor', 'warning');
                }
            } catch (error) {
                showNotification('‚ùå Error al sincronizar datos', 'warning');
                console.error('Error:', error);
            }
        }

        // ========== FUNCIONES DE EXPORTACI√ìN ==========

        // Exportar resultados
        function exportResults() {
            const results = getGameResults();
            const dataStr = JSON.stringify(results, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `resultados_liga_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            showNotification('‚úÖ Resultados exportados correctamente', 'success');
        }

        // Exportar noticias
        function exportNewsData() {
            const news = getAllNews();
            const dataStr = JSON.stringify(news, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `noticias_liga_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            showNotification('‚úÖ Noticias exportadas correctamente', 'success');
        }

        // Exportar todo
        function exportAllData() {
            const allData = {
                results: getGameResults(),
                news: getAllNews(),
                exportDate: new Date().toISOString(),
                version: '1.0'
            };
            const dataStr = JSON.stringify(allData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `backup_completo_liga_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            showNotification('‚úÖ Backup completo exportado correctamente', 'success');
        }

        // ========== FUNCIONES DE IMPORTACI√ìN ==========

        // Importar resultados
        function importResultsFile(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
                    showNotification('‚úÖ Resultados importados correctamente', 'success');
                    setTimeout(() => {
                        showNotification('üîÑ Recargando datos...', 'info');
                        setTimeout(() => {
                            location.reload();
                        }, 1000);
                    }, 1500);
                } catch (error) {
                    alert('‚ùå Error al importar resultados. Verifica que el archivo sea v√°lido.');
                    console.error('Error:', error);
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        // Importar noticias
        function importNewsFile(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (Array.isArray(data)) {
                        localStorage.setItem(NEWS_STORAGE_KEY, JSON.stringify(data));
                        showNotification('‚úÖ Noticias importadas correctamente', 'success');
                        setTimeout(() => {
                            showNotification('üîÑ Recargando datos...', 'info');
                            setTimeout(() => {
                                location.reload();
                            }, 1000);
                        }, 1500);
                    } else {
                        alert('‚ùå El archivo no contiene un formato v√°lido de noticias.');
                    }
                } catch (error) {
                    alert('‚ùå Error al importar noticias. Verifica que el archivo sea v√°lido.');
                    console.error('Error:', error);
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        // Importar todo
        function importAllFile(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    // Verificar que tenga la estructura correcta
                    if (data.results && data.news) {
                        localStorage.setItem(STORAGE_KEY, JSON.stringify(data.results));
                        localStorage.setItem(NEWS_STORAGE_KEY, JSON.stringify(data.news));
                        showNotification('‚úÖ Backup completo importado correctamente', 'success');
                        setTimeout(() => {
                            showNotification('üîÑ Recargando p√°gina...', 'info');
                            setTimeout(() => {
                                location.reload();
                            }, 1000);
                        }, 1500);
                    } else {
                        alert('‚ùå El archivo no contiene un backup completo v√°lido.');
                    }
                } catch (error) {
                    alert('‚ùå Error al importar backup. Verifica que el archivo sea v√°lido.');
                    console.error('Error:', error);
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        // Poblar filtro de jornadas
        function populateJornadaFilter() {
            const select = document.getElementById('filter-jornada');
            for (let i = 1; i <= 18; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = `Jornada ${i}`;
                select.appendChild(option);
            }
        }

        // Renderizar juegos en el admin
        function renderGamesAdmin() {
            const container = document.getElementById('games-admin-container');
            const filterVuelta = document.getElementById('filter-vuelta').value;
            const filterStatus = document.getElementById('filter-status').value;
            const filterJornada = document.getElementById('filter-jornada').value;

            // Agrupar por jornada
            const jornadasMap = {};
            schedule.forEach(game => {
                if (!game.homeTeam || !game.awayTeam) return;
                
                const jornada = game.jornada;
                if (!jornadasMap[jornada]) {
                    jornadasMap[jornada] = [];
                }
                jornadasMap[jornada].push(game);
            });

            let html = '';
            for (let i = 1; i <= 18; i++) {
                if (!jornadasMap[i]) continue;

                // Aplicar filtros
                if (filterJornada !== 'all' && parseInt(filterJornada) !== i) continue;
                if (filterVuelta === 'primera' && i > 9) continue;
                if (filterVuelta === 'segunda' && i <= 9) continue;

                const games = jornadasMap[i];
                const vuelta = i <= 9 ? 'Primera Vuelta' : 'Segunda Vuelta';
                const gameData = schedule.find(g => g.jornada === i && g.date);

                // Verificar si hay juegos que cumplan el filtro de estado
                let hasMatchingGames = false;
                if (filterStatus === 'all') {
                    hasMatchingGames = true;
                } else {
                    hasMatchingGames = games.some(game => game.status === filterStatus);
                }

                if (!hasMatchingGames) continue;

                html += `
                    <div class="jornada-admin">
                        <div class="jornada-admin-header">
                            Jornada ${i} - ${vuelta} 
                            <span style="font-size: 0.9em; opacity: 0.9; font-weight: normal;">
                                (${formatFullDate(gameData?.date)})
                            </span>
                        </div>
                `;

                games.forEach(game => {
                    if (filterStatus !== 'all' && game.status !== filterStatus) return;

                    const gameKey = `j${game.jornada}_${game.homeTeam}_${game.awayTeam}`;
                    const result = gameResults[gameKey] || { homeScore: '', awayScore: '' };
                    const hasScore = result.homeScore !== '' && result.awayScore !== '';

                    html += `
                        <div class="game-admin-card ${hasScore ? 'has-score' : ''}">
                            <div class="game-teams-admin">
                                <div class="team-score-input">
                                    <label>${game.homeTeam} (Local)</label>
                                    <input type="number" 
                                           id="home_${gameKey}" 
                                           value="${result.homeScore}"
                                           min="0" 
                                           placeholder="0">
                                </div>
                                <div class="vs-separator">VS</div>
                                <div class="team-score-input">
                                    <label>${game.awayTeam} (Visitante)</label>
                                    <input type="number" 
                                           id="away_${gameKey}" 
                                           value="${result.awayScore}"
                                           min="0" 
                                           placeholder="0">
                                </div>
                            </div>
                            <div class="game-actions">
                                <button class="btn btn-success" onclick="saveGameResult('${gameKey}')">
                                    üíæ Guardar Resultado
                                </button>
                                <button class="btn btn-secondary" onclick="clearGameResult('${gameKey}')">
                                    üóëÔ∏è Limpiar
                                </button>
                            </div>
                        </div>
                    `;
                });

                html += '</div>';
            }

            if (html === '') {
                html = '<div class="alert alert-info">No hay juegos que coincidan con los filtros seleccionados.</div>';
            }

            container.innerHTML = html;
        }

        // Guardar resultado de un juego
        function saveGameResult(gameKey) {
            const homeScore = document.getElementById(`home_${gameKey}`).value;
            const awayScore = document.getElementById(`away_${gameKey}`).value;

            if (homeScore === '' || awayScore === '') {
                alert('‚ö†Ô∏è Por favor ingresa ambos marcadores');
                return;
            }

            gameResults[gameKey] = {
                homeScore: parseInt(homeScore),
                awayScore: parseInt(awayScore),
                timestamp: new Date().toISOString()
            };

            saveResults();
            updateStats();
            
            // Efecto visual
            const card = event.target.closest('.game-admin-card');
            card.classList.add('has-score');
            
            // Mostrar notificaci√≥n mejorada
            showNotification('‚úÖ Resultado guardado correctamente', 'success');
            
            // Informar sobre actualizaci√≥n de tabla
            setTimeout(() => {
                showNotification('üìä La tabla de posiciones se actualizar√° autom√°ticamente en la p√°gina principal', 'info');
            }, 1000);
        }

        // Limpiar resultado de un juego
        function clearGameResult(gameKey) {
            if (confirm('¬øEst√°s seguro de que quieres limpiar este resultado?')) {
                delete gameResults[gameKey];
                saveResults();
                document.getElementById(`home_${gameKey}`).value = '';
                document.getElementById(`away_${gameKey}`).value = '';
                updateStats();
                
                const card = event.target.closest('.game-admin-card');
                card.classList.remove('has-score');
                
                showNotification('‚úÖ Resultado eliminado correctamente', 'success');
            }
        }

        // Actualizar estad√≠sticas
        function updateStats() {
            const totalGames = schedule.filter(g => g.homeTeam && g.awayTeam).length;
            const completedGames = schedule.filter(g => g.status === 'completed').length;
            const pendingGames = totalGames - completedGames;
            const gamesWithScore = Object.keys(gameResults).length;

            document.getElementById('total-games').textContent = totalGames;
            document.getElementById('completed-games').textContent = completedGames;
            document.getElementById('pending-games').textContent = pendingGames;
            document.getElementById('games-with-score').textContent = gamesWithScore;
        }

        // Aplicar filtros
        function applyFilters() {
            renderGamesAdmin();
        }

        // Formatear fecha
        function formatFullDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString + 'T00:00:00');
            const months = ['ene', 'feb', 'mar', 'abr', 'may', 'jun', 'jul', 'ago', 'sep', 'oct', 'nov', 'dic'];
            return `${date.getDate()} ${months[date.getMonth()]} ${date.getFullYear()}`;
        }

        // Mostrar notificaci√≥n
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 25px;
                border-radius: 8px;
                box-shadow: 0 4px 6px rgba(0,0,0,0.2);
                z-index: 10000;
                animation: slideIn 0.3s ease-out;
                max-width: 400px;
                font-weight: 500;
            `;
            
            if (type === 'success') {
                notification.style.background = '#28a745';
                notification.style.color = 'white';
            } else if (type === 'info') {
                notification.style.background = '#17a2b8';
                notification.style.color = 'white';
            } else if (type === 'warning') {
                notification.style.background = '#ffc107';
                notification.style.color = '#333';
            }
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            // Ocultar despu√©s de 3 segundos
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-out';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Enter para login
        document.addEventListener('DOMContentLoaded', function() {
            const passwordInput = document.getElementById('admin-password');
            passwordInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    login();
                }
            });
            // Auto-focus en el campo de contrase√±a
            passwordInput.focus();
        });
    </script>
</body>
</html>

